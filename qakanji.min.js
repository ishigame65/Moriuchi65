let app;window.onload=()=>{app=new App;try{app.init()}catch(b){console.log(b),alert("\u30a8\u30e9\u30fc:"+b)}};
class App{constructor(){this.qaInstruction=this.qaTitle=this.qaContents=this.contentsText=this.instructionText=this.titleText=null}init(){this.titleText=document.querySelector("#TITLE_TEXT");this.instructionText=document.querySelector("#INSTRUCTION_TEXT");this.contentsText=document.querySelector("#CONTENTS_TEXT");this.qaContents=document.querySelector("#QACONTENTS");this.qaTitle=document.querySelector("#QATITLE");this.qaInstruction=document.querySelector("#QAINSTRUCTION");FileUtil.initDnDReadText(this.contentsText,
null,b=>this.setText(b))}createPracticeQA(b){var c=/[\u{3000}-\u{301C}\u{3041}-\u{3093}\u{309B}-\u{309E}]/mu;try{this.qaContents.innerHTML="";this.qaTitle.innerText=this.titleText.value;this.qaInstruction.innerText=this.instructionText.value;var a=this.contentsText.value;const d=[],e=[];for(let g of a.split("\n")){a=[];const f=[];for(let h of g.split(/\uff1c|\uff1e/)){if(""==h)continue;let k=h.split(/\uff08|\uff09/);1<k.length?c.test(k[0])?(f.push(k[0]),a.push('<span class="ISKANA">'+k[1]+"</span>")):
(f.push(k[0]),a.push('<span class="NOKANA">'+k[1]+"</span>")):(a.push(h),f.push(h))}0!=a.length&&(d.push(a.join("")),e.push(f.join("")))}c='<ol class="MARU_NUM_LIST">';for(let [g,f]of zip(d,e))c+="<li>",c+=g,c+='<div class="ANSWER">',c=b?c+f:c+"\u3000",c+="</div>";c+="</ol>";console.log(c);this.qaContents.innerHTML=c}catch(d){console.error(d),this.qaContents.innerHTML=d.stack}}setText(b){this.contentsText.innerText=b}async readFile(b){(b=await FileUtil.readTextSync(b))?this.contentsText.innerText=
b:alert("\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308a\u307e\u305b\u3093")}downloadText(){FileUtil.downloadText(this.contentsText.value,this.titleText.value)}clearText(){this.contentsText.innerText=""}}function*zip(...b){const c=b[0].length;for(var a of b)if(a.length!==c)throw"Lengths of arrays are not eqaul.";for(a=0;a<c;a++){let d=[];for(arr of b)d.push(arr[a]);yield d}};let FileUtil={downloadText:function(b,c){const a=document.createElement("a");b=URL.createObjectURL(new Blob([b],{type:"text/plain"}));a.href=b;a.download=c;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(b)},readText:function(b,c="utf-8",a){const d=new FileReader;d.onload=e=>a(e.target.result,b,e);d.onerror=e=>a(null,b,e);d.readAsText(b,c)},readTextSync:async function(b,c){return(new Promise((a,d)=>{FileUtil.readText(b,c,(e,g,f)=>a(e))})).then(a=>a)},initDnDReadText:function(b,
c="utf-8",a){this.initDnDFile(b,(d,e)=>{this.readText(d,c,(g,f,h)=>a(g,f,h,e))})},initDnDFile:function(b,c){b.addEventListener("drop",a=>{a.preventDefault();const d=a.dataTransfer.files[0];d&&c(d,a)});b.addEventListener("dragover",a=>{a.preventDefault()})}};
